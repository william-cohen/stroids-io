!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var s=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e+0,this.y=i+0}return n(t,[{key:"mag2",value:function(){return this.x*this.x+this.y*this.y}},{key:"mag",value:function(){return Math.sqrt(this.mag2())}},{key:"add",value:function(e){return new t(this.x+e.x,this.y+e.y)}},{key:"subtract",value:function(e){return new t(this.x-e.x,this.y-e.y)}},{key:"scale",value:function(e){return new t(this.x*e,this.y*e)}},{key:"clone",value:function(){return new t(this.x,this.y)}}]),t}();t.exports=s},function(t,e,i){"use strict";var n=1e3,s=.95*window.innerWidth,r=.95*window.innerHeight,a=document.getElementById("gameCanvas");a.width=s,a.height=r;var o=a.getContext("2d"),h=io("localhost:3000"),u=i(2),l=i(4),c=i(7),f=i(8),p=i(9),d=i(10).init(h),y=prompt("Please enter a username: ");h.emit("join",y);for(var v=new u(h),g=new f,w=[],m="",x=[],k=Math.round(s*r*18e-6),b=0;b<k;b++)x.push(new p(3,n,n,v)),x.push(new p(2,n,n,v)),x.push(new p(1,n,n,v));h.on("drop",function(){d.calc()}),h.on("message",function(t){console.log("Message: "+t)}),h.on("state",function(t){m=t.leader;var e=t.player,i=t.enemies||[],n=t.removedPlayers,s=t.addedPlayers,r=t.updatedAsteroids;v.updateState(e),v.score=t.score;for(var a=0;a<i.length;a++){var o=i[a],h=o.id;g.has(h)||g.set(h,new l(h,"")),g.get(h).updateState(o)}for(var u=0;u<n.length;u++)g.delete(n[u]);for(var f=0;f<s.length;f++){var p=s[f];p.id!=v.id&&g.set(p.id,new l(p.id,p.username))}for(var d=0;d<r.length;d++){var y=r[d],x=y.id;null==w[x]&&(w[x]=new c(x%3+1)),w[x].setState(y)}});var P=Date.now();setInterval(function(){!function(t){d.update();for(var e=0;e<g.length;e++)g[e].update(t);for(var i=0;i<w.length;i++)w[i].update(t);if(v.alive){for(var n=0;n<x.length;n++)x[n].update();v.update(t)}}((Date.now()-P)/1e3),P=Date.now(),function(){if(null!=v){o.clearRect(0,0,s,r),o.setTransform(1,0,0,1,s/2-v.pos.x,r/2-v.pos.y),o.strokeStyle="white",o.strokeRect(0,0,n,n);for(var t=0;t<x.length;t++)x[t].draw(o);for(var e=g.values(),i=0;i<e.length;i++)e[i].draw(o);for(var a=0;a<w.length;a++)null!=w[a]&&w[a].draw(o);v.alive&&v.draw(o),o.setTransform(1,0,0,1,0,0),o.font="12px serif",o.fillStyle="white",o.fillText("Ping: "+d.currentLatency,s-100,10),o.font="14px serif",o.fillStyle="white",o.fillText("Score: "+v.score,20,20),o.font="24px serif",o.fillStyle="white";var h=m==v.id?"You are the leader.":"Leader: "+(g.get(m)||{username:" "}).username;o.fillText(h,s/2-50,20),v.alive||(o.font="32px serif",o.fillStyle="white",o.fillText("You died.",50,150))}}()},1e3/30),console.log("Client v0.2.0")},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var s=i(3),r=i(0),a=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tick=0,this.socket=e,this.id="null",this.alive=!0,this.pos=new r(0,0),this.vel=new r(0,0),this.rotation=0,this.keys=new s,this.sprite=new Image,this.sprite.src="img/player.png",this.spriteT=new Image,this.spriteT.src="img/playerT.png",this.spriteT2=new Image,this.spriteT2.src="img/playerT2.png"}return n(t,[{key:"updateState",value:function(t){this.id=t.id,this.pos.x=t.x,this.pos.y=t.y,this.vel.x=t.vx,this.vel.y=t.vy,this.rotation=t.rotation,this.alive=t.alive}},{key:"update",value:function(t){var e=new r(0,0),i={W:!1,A:!1,S:!1,D:!1};this.tick++,this.tick%=30,this.alive&&(this.thrusting=!1,this.tick++,this.tick%=30,this.keys.isPressed(37)&&(i.A=!0,this.rotation-=3*t),this.keys.isPressed(39)&&(i.D=!0,this.rotation+=3*t),(this.keys.isPressed(38)||this.keys.isPressed(32))&&(i.W=!0,this.thrusting=!0,e.x=30*Math.cos(this.rotation),e.y=30*Math.sin(this.rotation)),this.socket.emit("input",i)),this.vel=this.vel.add(e.subtract(this.vel.scale(1.75)).scale(t)),this.pos=this.pos.add(this.vel)}},{key:"draw",value:function(t){this.alive&&(t.save(),t.translate(this.pos.x,this.pos.y),t.rotate(this.rotation+Math.PI/2),t.translate(-this.pos.x,-this.pos.y),this.thrusting?this.tick%10>5?t.drawImage(this.spriteT,this.pos.x-19,this.pos.y-24):t.drawImage(this.spriteT2,this.pos.x-19,this.pos.y-24):t.drawImage(this.sprite,this.pos.x-19,this.pos.y-24),t.restore())}}]),t}();t.exports=a},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.pressedKeys=[],document.addEventListener("keydown",this.keydown.bind(this)),document.addEventListener("keyup",this.keyup.bind(this))}return n(t,[{key:"keydown",value:function(t){this.pressedKeys[t.keyCode]=!0}},{key:"keyup",value:function(t){this.pressedKeys[t.keyCode]=!1}},{key:"isPressed",value:function(t){return!!this.pressedKeys[t]}}]),t}();t.exports=s},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var s=i(0),r=i(5),a=i(6),o=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=e,this.username=i,this.pos=new s(0,0),this.vel=new s(0,0),this.rotation=0,this.oldPos=new s(0,0),this.oldVel=new s(0,0),this.oldRotation=0,this.lerp_t=0,this.sprite=new Image,this.sprite.src="img/player.png",this.spriteT=new Image,this.spriteT.src="img/playerT.png",this.spriteT2=new Image,this.spriteT2.src="img/playerT2.png",this.tick=0,this.thrust=!1,this.alive=!0}return n(t,[{key:"updateState",value:function(t){this.oldPos=this.pos.clone(),this.oldVel=this.vel.clone(),this.oldRotation=this.rotation,this.lerp_t=0,this.pos.x=t.x,this.pos.y=t.y,this.vel.x=t.vx,this.vel.y=t.vy,console.log(this.pos),this.rotation=t.rotation,this.thrust=t.thrust,this.alive=t.alive}},{key:"update",value:function(t){this.alive&&(this.tick++,this.tick%=6)}},{key:"draw",value:function(t){if(this.alive){this.lerp_t+=1/6;var e=r(this.oldPos,this.oldVel,this.pos,this.vel,this.lerp_t),i=a.angleDelta(this.rotation,this.oldRotation),n=this.oldRotation+i*this.lerp_t;t.save(),t.translate(e.x,e.y),t.rotate(n+Math.PI/2),t.translate(-e.x,-e.y),this.thrust?this.tick>2?t.drawImage(this.spriteT,e.x-19,e.y-24):t.drawImage(this.spriteT2,e.x-19,e.y-24):t.drawImage(this.sprite,e.x-19,e.y-24),t.restore(),t.font="12px serif",t.fillStyle="white",t.fillText(this.username,e.x-25,e.y+45)}}}]),t}();t.exports=o},function(t,e,i){"use strict";i(0);t.exports=function(t,e,i,n,s){return t.scale(2*s*s*s-3*s*s+1).add(e.scale(s*s*s-2*s*s+s)).add(i.scale(-2*s*s*s+3*s*s)).add(n.scale(s*s*s-s*s))}},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return n(t,null,[{key:"angleDelta",value:function(t,e){var i=Math.abs(t-e);return(i>Math.PI?2*Math.PI-i:i)*(t-e>=0&&t-e<=Math.PI||t-e<=-Math.PI&&t-e>=-2*Math.PI?1:-1)}}]),t}();t.exports=s},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var s=i(0),r=function(){function t(e){switch(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.pos=new s(0,0),this.vel=new s(0,0),this.sprite=new Image,this.sprite.src="",this.radius=0,e){case 1:this.sprite.src="img/rock1.png",this.radius=10;break;case 2:this.sprite.src="img/rock2.png",this.radius=15;break;case 3:this.sprite.src="img/rock3.png",this.radius=25}}return n(t,[{key:"setState",value:function(t){this.pos.x=t.x,this.pos.y=t.y,this.vel.x=t.vx,this.vel.y=t.vy}},{key:"update",value:function(t){this.pos.x+=this.vel.x*t,this.pos.y+=this.vel.y*t}},{key:"draw",value:function(t){t.save(),t.translate(this.pos.x,this.pos.y),t.rotate(this.rotation+Math.PI/2),t.translate(-this.pos.x,-this.pos.y),t.drawImage(this.sprite,this.pos.x-this.radius,this.pos.y-this.radius),t.restore()}}]),t}();t.exports=r},function(t,e,i){"use strict";var n,s,r;"function"==typeof Symbol&&Symbol.iterator;s=[],void 0===(r="function"==typeof(n=function(){function t(t){switch(this.clear(),arguments.length){case 0:break;case 1:"length"in t?i(this,Array.prototype.concat.apply([],t)):this.copy(t);break;default:i(this,arguments)}}var e=t.prototype={constructor:t,get:function(t){var e=this._data[this.hash(t)];return e&&e[1]},set:function(t,e){var i=this.hash(t);i in this._data||this.size++,this._data[i]=[t,e]},multi:function(){i(this,arguments)},copy:function(t){for(var e in t._data)e in this._data||this.size++,this._data[e]=t._data[e]},has:function(t){return this.hash(t)in this._data},search:function(t){for(var e in this._data)if(this._data[e][1]===t)return this._data[e][0];return null},delete:function(t){var e=this.hash(t);e in this._data&&(this.size--,delete this._data[e])},type:function(t){var e=Object.prototype.toString.call(t),i=e.slice(8,-1).toLowerCase();return t||"domwindow"!==i&&"window"!==i?i:t+""},keys:function(){var t=[];return this.forEach(function(e,i){t.push(i)}),t},values:function(){var t=[];return this.forEach(function(e){t.push(e)}),t},entries:function(){var t=[];return this.forEach(function(e,i){t.push([i,e])}),t},count:function(){return this.size},clear:function(){this._data={},this.size=0},clone:function(){return new t(this)},hash:function(e){switch(this.type(e)){case"undefined":case"null":case"boolean":case"number":case"regexp":return e+"";case"date":return"♣"+e.getTime();case"string":return"♠"+e;case"array":for(var i=[],n=0;n<e.length;n++)i[n]=this.hash(e[n]);return"♥"+i.join("⁞");default:return e.hasOwnProperty("_hmuid_")||(e._hmuid_=++t.uid,function(t,e){Object.defineProperty&&Object.defineProperty(t,e,{enumerable:!1})}(e,"_hmuid_")),"♦"+e._hmuid_}},forEach:function(t,e){for(var i in this._data){var n=this._data[i];t.call(e||this,n[1],n[0])}}};function i(t,e){for(var i=0;i<e.length;i+=2)t.set(e[i],e[i+1])}return t.uid=0,["set","multi","copy","delete","clear","forEach"].forEach(function(t){var i=e[t];e[t]=function(){return i.apply(this,arguments),this}}),t.prototype.remove=t.prototype.delete,t})?n.apply(e,s):n)||(t.exports=r)},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var s=function(){function t(e,i,n,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=Math.random()*i,this.y=Math.random()*n,this.maxX=i,this.maxY=n,this.player=s,this.size=e}return n(t,[{key:"update",value:function(){switch(this.x<0&&(this.x+=this.maxX),this.x>this.maxX&&(this.x-=this.maxX),this.y<0&&(this.y+=this.maxY),this.y>this.maxY&&(this.y-=this.maxY),this.size){case 1:this.x+=.5*this.player.vel.x,this.y+=.5*this.player.vel.y;break;case 2:this.x+=.33*this.player.vel.x,this.y+=.33*this.player.vel.y;break;case 3:this.x+=.165*this.player.vel.x,this.y+=.165*this.player.vel.y}}},{key:"draw",value:function(t){t.beginPath(),t.rect(this.x,this.y,this.size,this.size),t.fillStyle="#ffffff",t.fill(),t.closePath()}}]),t}();t.exports=s},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.socket=e,this.lastDrip=Date.now(),this.tick=0,this.data=[],this.count=0,this.currentLatency=0}return n(t,[{key:"getMean",value:function(){if(0==this.data.length)return-1;for(var t=0,e=0;e<this.data.length;e++)t+=this.data[e];return t/=this.data.length}},{key:"getSd",value:function(t){if(0==this.data.length)return-1;for(var e=0,i=0;i<this.data.length;i++)e+=this.data[i]*this.data[i];return e-=t*t,Math.sqrt(e)}},{key:"calc",value:function(){this.count%=10;var t=(Date.now()-this.lastDrip)/2,e=this.getMean(),i=this.getSd(e);(this.data.length<10||Math.abs(e-t)<2*i)&&(this.data[this.count++]=t)}},{key:"update",value:function(){1==this.tick?(this.socket.emit("drip"),this.lastDrip=Date.now()):2==this.tick&&(this.currentLatency=Math.round(this.getMean())),this.tick++,this.tick%=30}}],[{key:"init",value:function(e){return new t(e)}}]),t}();t.exports=s}]);
//# sourceMappingURL=game.js.map